init_modal_dialogs=function(){$('a[href*="dialog=true"]').not("#dialog_container a").each(function(a,b){$(b).data({"dialog-width":parseInt($($(b).attr("href").match("width=([0-9]*)")).last().get(0),10)||928,"dialog-height":parseInt($($(b).attr("href").match("height=([0-9]*)")).last().get(0),10)||473,"dialog-title":$(b).attr("title")||$(b).attr("name")||$(b).html()||null}).attr("href",$(b).attr("href").replace(/(\&(amp\;)?)?dialog\=true/,"").replace(/(\&(amp\;)?)?width\=\d+/,"").replace(/(\&(amp\;)?)?height\=\d+/,"").replace(/(\?&(amp\;)?)/,"?").replace(/\?$/,"")).click(function(a){$anchor=$(this),iframe_src=(iframe_src=$anchor.attr("href"))+(iframe_src.indexOf("?")>-1?"&":"?")+"app_dialog=true&dialog=true",iframe=$("<iframe id='dialog_iframe' frameborder='0' marginheight='0' marginwidth='0' border='0'></iframe>"),$.browser.msie||iframe.corner("8px"),iframe.dialog({title:$anchor.data("dialog-title"),modal:!0,resizable:!1,autoOpen:!0,width:$anchor.data("dialog-width"),height:$anchor.data("dialog-height"),open:onOpenDialog,close:onCloseDialog}),iframe.attr("src",iframe_src),a.preventDefault()})})},init_sortable_menu=function(){var a=$("#menu");if(a.length===0)return;a.sortable({axis:"x",cursor:"crosshair",connectWith:".nested",update:function(){$.post("/refinery/update_menu_positions",a.sortable("serialize",{key:"menu[]",expression:/plugin_([\w]*)$/}))}}).tabs(),a.sortable("disable"),a.find("#menu_reorder").click(function(a){trigger_reordering(a,!0)}),a.find("#menu_reorder_done").click(function(a){trigger_reordering(a,!1)}),a.find("> a").corner("top 5px")},trigger_reordering=function(a,b){a.preventDefault(),$("#menu_reorder, #menu_reorder_done").toggle(),$("#site_bar, #content").fadeTo(500,b?.35:1),b?$menu.find(".tab a").click(function(a){a.preventDefault()}):$menu.find(".tab a").unbind("click"),$menu.sortable(b?"enable":"disable")},init_submit_continue=function(){$("#submit_continue_button").click(submit_and_continue),$("form").change(function(a){$(this).attr("data-changes-made",!0)}),(continue_editing_button=$("#continue_editing")).length>0&&continue_editing_button.attr("rel")!="no-prompt"&&$("#editor_switch a").click(function(a){$("form[data-changes-made]").length>0&&(confirm("translation missing: en.js.admin.confirm_changes")||a.preventDefault())})},submit_and_continue=function(a,b){$(this).hasClass("wymupdate")&&$.each(WYMeditor.INSTANCES,function(a,b){b.update()}),$("#continue_editing").val(!0),$("#flash").fadeOut(250),$(".fieldWithErrors").removeClass("fieldWithErrors").addClass("field"),$("#flash_container .errorExplanation").remove(),$.post($("#continue_editing").get(0).form.action,$($("#continue_editing").get(0).form).serialize(),function(a){($flash_container=$("#flash_container")).length>0&&($flash_container.html(a),$("#flash").css({width:"auto",visibility:null}).fadeIn(550),$(".errorExplanation").not($("#flash_container .errorExplanation")).remove(),(error_fields=$("#fieldsWithErrors").val())!=null?$.each(error_fields.split(","),function(){$("#"+this).wrap("<div class='fieldWithErrors' />")}):b&&(window.location=b),$(".fieldWithErrors:first :input:first").focus(),$("#continue_editing").val(!1),init_flash_messages())}),a.preventDefault()};