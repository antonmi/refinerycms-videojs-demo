<%= f.fields_for :video_files do |v| %>
    <div class="parent">
      <label>(<%= v.object.mime_type %>)</label>
        <span>
          <%= v.radio_button :use_external, false, {:class => "use_file"}.merge(v.object.use_external ? {} : {:checked => true}) %>
          <%= v.label :use_external, 'Use file', :class => 'stripped' %>
        </span>
        <span>
          <%= v.radio_button :use_external, true, {:class => "use_external"}.merge(v.object.use_external ? {:checked => true} : {}) %>
          <%= v.label :use_external, 'Use external source', :class => 'stripped' %>
        </span>

      <div class='field'>
        <%# binding.pry %>
        <% unless v.object.file.present? %>
            <div class="use_file" style='display: none;'>
              <span>Add File</span>
              <%= v.file_field :file%>
            </div>
            <% else %>
        <div class="use_file">
          <%= link_to(t('.download_current'), v.object.url,
                      :title => v.object.file_name)  %>
          <em><%= t('.or') %> </em><%= t('.replace') %>


          <%= v.file_field :file %>
          <%= link_to refinery_icon_tag("delete.png"), refinery.videos_admin_video_file_path(v.object),
                      :class => "cancel confirm-delete",
                      :title => t('.delete'),
                      :confirm => t('message', :scope => 'refinery.admin.delete', :title => v.object.file_name),
                      :method => :delete %>
        </div>
            <% end %>
>     <div class="use_external" <%= "style='display: none;'" unless v.object.use_external %>>
          <span>Link to source</span>
          <%= v.text_field :external_url %>
        </div>
      </div>
    </div>
<% end %>

<% (@mime_types - @video.video_files.map(&:file_mime_type)).each_with_index do |mime_type, index| %>
    <div class="parent">
      <label>(<%= mime_type %>)</label>
      <% number = @video.video_files.count + index %>
      <span>
          <input checked="checked" class="use_file" id="video_video_files_attributes_<%= number %>_use_external_false" name="video[video_files_attributes][<%= number %>][use_external]" type="radio" value="false">
          <label class="stripped" for="video_video_files_attributes_<%= number %>_use_external_false">Use file</label>
        </span>
        <span>
           <input class="use_external" id="video_video_files_attributes_<%= number %>_use_external_true" name="video[video_files_attributes][<%= number %>][use_external]" type="radio" value="true">
                  <label class="stripped" for="video_video_files_attributes_<%= number %>_use_external_true">Use external source</label>
        </span>
      <div class='field'>
        <div class="use_file">
          <span>Add File</span>
          <input id="video_video_files_attributes_<%= number %>_file" name="video[video_files_attributes][<%= number %>][file]" type="file">
        </div>
        <div class="use_external" style='display: none;'>
          <span>Link to source</span>
          <input id="video_video_files_attributes_<%= number %>_external_url" name="video[video_files_attributes][<%= number %>][external_url]" size="30" type="text" value="">
        </div>
      </div>
    </div>
<% end %>